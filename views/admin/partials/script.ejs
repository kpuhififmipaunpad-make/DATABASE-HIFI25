<!-- jQuery (required for DataTables) -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

<!-- Bootstrap Bundle (if needed) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

<!-- DataTables Core -->
<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>

<!-- DataTables Responsive Extension -->
<script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.5.0/js/responsive.bootstrap5.min.js"></script>

<!-- DataTables Buttons Extension -->
<script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.bootstrap5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.print.min.js"></script>

<!-- Font Awesome -->
<script src="https://kit.fontawesome.com/your-kit-code.js" crossorigin="anonymous"></script>

<!-- Custom DataTable Initialization -->
<script>
$(document).ready(function() {
    console.log('ðŸš€ Initializing DataTable...');
    
    // Initialize DataTable with enhanced configuration
    const table = $('#usersTable').DataTable({
        // Responsive
        responsive: {
            details: {
                type: 'column',
                target: 0,
                renderer: function(api, rowIdx, columns) {
                    const data = $.map(columns, function(col, i) {
                        return col.hidden ?
                            '<li data-dtr-index="' + col.columnIndex + '" data-dt-row="' + col.rowIndex + '" data-dt-column="' + col.columnIndex + '">' +
                            '<span class="dtr-title">' + col.title + '</span> ' +
                            '<span class="dtr-data">' + col.data + '</span>' +
                            '</li>' :
                            '';
                    }).join('');
                    return data ? $('<ul class="dtr-details"/>').append(data) : false;
                }
            }
        },
        
        // Column definitions
        columnDefs: [
            {
                className: 'dtr-control',
                orderable: false,
                targets: 0,
                render: function() {
                    return '<i class="fas fa-plus-circle" style="color: #DC143C; cursor: pointer; font-size: 16px;"></i>';
                }
            },
            {
                targets: -1, // Last column (Actions)
                orderable: false,
                searchable: false
            }
        ],
        
        // Layout and styling
        order: [[1, 'asc']], // Sort by Name (second column)
        pageLength: 10,
        lengthMenu: [[10, 25, 50, 100, -1], [10, 25, 50, 100, "Semua"]],
        language: {
            url: '//cdn.datatables.net/plug-ins/1.13.7/i18n/id.json',
            search: "_INPUT_",
            searchPlaceholder: "Cari data...",
            lengthMenu: "Tampilkan _MENU_ data",
            info: "Menampilkan _START_ sampai _END_ dari _TOTAL_ data",
            infoEmpty: "Tidak ada data",
            infoFiltered: "(difilter dari _MAX_ total data)",
            paginate: {
                first: '<i class="fas fa-angle-double-left"></i>',
                previous: '<i class="fas fa-angle-left"></i>',
                next: '<i class="fas fa-angle-right"></i>',
                last: '<i class="fas fa-angle-double-right"></i>'
            }
        },
        
        // Buttons configuration
        dom: '<"row"<"col-sm-12 col-md-6"l><"col-sm-12 col-md-6"f>>' +
             '<"row"<"col-sm-12 col-md-12"B>>' +
             '<"row"<"col-sm-12"tr>>' +
             '<"row"<"col-sm-12 col-md-5"i><"col-sm-12 col-md-7"p>>',
        
        buttons: [
            {
                extend: 'copy',
                text: '<i class="fas fa-copy"></i> Copy',
                className: 'btn-primary-gradient',
                exportOptions: {
                    columns: ':visible:not(:last-child)'
                }
            },
            {
                extend: 'excel',
                text: '<i class="fas fa-file-excel"></i> Excel',
                className: 'btn-primary-gradient',
                exportOptions: {
                    columns: ':visible:not(:last-child)'
                }
            },
            {
                extend: 'pdf',
                text: '<i class="fas fa-file-pdf"></i> PDF',
                className: 'btn-primary-gradient',
                orientation: 'landscape',
                pageSize: 'A4',
                exportOptions: {
                    columns: ':visible:not(:last-child)'
                }
            },
            {
                extend: 'print',
                text: '<i class="fas fa-print"></i> Print',
                className: 'btn-primary-gradient',
                exportOptions: {
                    columns: ':visible:not(:last-child)'
                }
            }
        ],
        
        // Performance
        deferRender: true,
        processing: true,
        
        // Callbacks
        drawCallback: function() {
            console.log('âœ… DataTable drawn');
            
            // Add smooth animations to rows
            $('#usersTable tbody tr').each(function(index) {
                $(this).css({
                    'animation': `fadeInUp 0.4s ease-out ${index * 0.05}s both`
                });
            });
        },
        
        initComplete: function() {
            console.log('âœ… DataTable initialized successfully');
            
            // Add custom styling to buttons
            $('.dt-buttons').addClass('mb-3');
            $('.dt-button').addClass('me-2');
            
            // Add loading state removal
            $('.table-container').removeClass('loading');
        }
    });
    
    // Add row click animation
    $('#usersTable tbody').on('click', 'tr', function() {
        if (!$(this).hasClass('child')) {
            $(this).toggleClass('shown');
        }
    });
    
    // Add search enhancement
    $('#usersTable_filter input').addClass('form-control-glass');
    $('#usersTable_length select').addClass('form-control-glass');
    
    console.log('âœ… DataTable setup complete');
});

// Handle delete confirmation
function confirmDelete(id, nama) {
    if (confirm(`Apakah Anda yakin ingin menghapus data ${nama}?`)) {
        document.getElementById(`deleteForm-${id}`).submit();
    }
}

// Auto-dismiss alerts after 5 seconds
setTimeout(function() {
    const alerts = document.querySelectorAll('.alert-glass');
    alerts.forEach(alert => {
        alert.style.opacity = '0';
        alert.style.transform = 'translateX(100px)';
        setTimeout(() => alert.remove(), 400);
    });
}, 5000);
</script>

<!-- Custom Animations -->
<style>
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Loading State */
.table-container.loading::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    z-index: 999;
    display: flex;
    align-items: center;
    justify-content: center;
}

.table-container.loading::after {
    content: 'Memuat data...';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1000;
    color: #1E3A8A;
    font-weight: 600;
    font-size: 16px;
}
</style>
