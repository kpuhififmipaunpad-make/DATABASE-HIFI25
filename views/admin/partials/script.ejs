<!-- Font Awesome Icon -->
<script src="https://kit.fontawesome.com/7cc967098c.js" crossorigin="anonymous"></script>

<!-- Iconify -->
<script src="https://cdn.jsdelivr.net/npm/@iconify/iconify@2.2.1/dist/iconify.min.js"></script>

<!-- jQuery & jQuery UI -->
<script src="/adminlte/plugins/jquery/jquery.min.js"></script>
<script src="/adminlte/plugins/jquery-ui/jquery-ui.min.js"></script>
<script>
  // Resolve conflict in jQuery UI tooltip with Bootstrap tooltip
  $.widget.bridge('uibutton', $.ui.button)
</script>

<!-- Bootstrap -->
<script src="/adminlte/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>

<!-- AdminLTE core -->
<script src="/adminlte/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>
<script src="/adminlte/dist/js/adminlte.js"></script>

<!-- (opsional) libs lain yang mungkin kamu pakai -->
<script src="/adminlte/plugins/chart.js/Chart.min.js"></script>
<script src="/adminlte/plugins/sparklines/sparkline.js"></script>
<script src="/adminlte/plugins/jqvmap/jquery.vmap.min.js"></script>
<script src="/adminlte/plugins/jqvmap/maps/jquery.vmap.usa.js"></script>
<script src="/adminlte/plugins/moment/moment.min.js"></script>
<script src="/adminlte/plugins/daterangepicker/daterangepicker.js"></script>
<script src="/adminlte/plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js"></script>
<script src="/adminlte/plugins/summernote/summernote-bs4.min.js"></script>
<script src="/adminlte/plugins/bs-custom-file-input/bs-custom-file-input.min.js"></script>

<!-- DataTables & Plugins (Bootstrap 4 skin) -->
<script src="/adminlte/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="/adminlte/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
<script src="/adminlte/plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
<script src="/adminlte/plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
<script src="/adminlte/plugins/datatables-buttons/js/dataTables.buttons.min.js"></script>
<script src="/adminlte/plugins/datatables-buttons/js/buttons.bootstrap4.min.js"></script>
<script src="/adminlte/plugins/jszip/jszip.min.js"></script>
<script src="/adminlte/plugins/pdfmake/pdfmake.min.js"></script>
<script src="/adminlte/plugins/pdfmake/vfs_fonts.js"></script>
<script src="/adminlte/plugins/datatables-buttons/js/buttons.html5.min.js"></script>
<script src="/adminlte/plugins/datatables-buttons/js/buttons.print.min.js"></script>
<script src="/adminlte/plugins/datatables-buttons/js/buttons.colVis.min.js"></script>

<!-- Page specific: DataTable init for #usersTable -->
<script>
  $(function () {
    const $table = $('#usersTable');
    if (!$table.length) return;

    // Jangan re-init. Kalau sudah hidup, cukup adjust layout.
    if ($.fn.DataTable.isDataTable($table)) {
      $table.DataTable().columns.adjust().responsive.recalc();
      return;
    }

    const dt = $table.DataTable({
      // destroy/retrieve tidak dipakai agar DOM tidak terhapus
      deferRender: true,
      autoWidth: false,
      scrollX: true,

      responsive: { details: { type: 'inline' } },

      pagingType: 'simple_numbers',
      lengthChange: true,
      pageLength: 10,
      lengthMenu: [
        [10, 20, 30, 40, 50, -1],
        [10, 20, 30, 40, 50, "Semua"]
      ],

      order: [[0, 'asc']],
      columnDefs: [
        { targets: [0, 5, 7], className: 'text-center' },   // No, Role, Aksi
        { targets: 7, orderable: false, searchable: false } // Aksi bukan sorting/search
      ],

      dom: 'Bfrtip',
      buttons: [
        { extend: 'copyHtml5',  exportOptions: { columns: ':not(.no-export)' } },
        { extend: 'csvHtml5',   exportOptions: { columns: ':not(.no-export)' } },
        { extend: 'excelHtml5', exportOptions: { columns: ':not(.no-export)' } },
        {
          extend: 'pdfHtml5',
          exportOptions: { columns: ':not(.no-export)' },
          orientation: 'landscape',
          pageSize: 'A4'
        },
        { extend: 'print', exportOptions: { columns: ':not(.no-export)' } },
        'colvis'
      ],

      language: {
        search: "Cari:",
        lengthMenu: "Tampilkan _MENU_ data",
        info: "Menampilkan _START_â€“_END_ dari _TOTAL_ data",
        infoEmpty: "Tidak ada data",
        infoFiltered: "(difilter dari _MAX_ total data)",
        zeroRecords: "Data tidak ditemukan",
        paginate: {
          first: "Awal",
          last: "Akhir",
          next: "Berikut",
          previous: "Sebelum"
        }
      }
    });

    // Taruh tombol export/colvis di kiri atas wrapper
    const $target = $('#usersTable_wrapper .col-md-6').eq(0);
    if ($target.length) {
      dt.buttons().container().appendTo($target);
    }

    // Recalc saat halaman kembali dari bfcache (back button)
    window.addEventListener('pageshow', (e) => {
      if (e.persisted) {
        dt.columns.adjust().responsive.recalc();
      }
    });
  });
</script>

</body>
</html>
